name: Cache Cleanup

on:
  schedule:
    # 매주 일요일 새벽 2시에 실행
    - cron: '0 2 * * 0'
  workflow_dispatch:

jobs:
  cleanup:
    name: Cleanup old caches
    runs-on: ubuntu-latest
    
    steps:
      - name: 🧹 Cleanup npm cache
        uses: actions/cache@v4
        with:
          path: |
            ~/.npm
            node_modules
            */*/node_modules
          key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-node-
        env:
          NODE_OPTIONS: --max_old_space_size=4096
          
      - name: 🧹 Cleanup Next.js cache
        uses: actions/cache@v4
        with:
          path: |
            .next/cache
          key: ${{ runner.os }}-nextjs-${{ hashFiles('**/package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-nextjs-
            
      - name: 📊 Report cache status
        run: |
          echo "Cache cleanup completed"
          echo "Date: $(date)"
          echo "Runner: ${{ runner.os }}"
